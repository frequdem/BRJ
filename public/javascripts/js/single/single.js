!function(t){function e(n){if(o[n])return o[n].exports;var a=o[n]={exports:{},id:n,loaded:!1};return t[n].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var o={};return e.m=t,e.c=o,e.p="",e(0)}([function(t,e,o){$(function(){function t(t){function e(t){return t<10&&(t="0"+t),t}var o="";t.forEach(function(n,a){var s=new Date(n.time);o=s.getFullYear()+"-"+e(s.getMonth()+1)+"-"+e(s.getDate())+" "+e(s.getHours())+":"+e(s.getMinutes()),t[a].time=o}),$(".comments").html(a({datas:t}))}var e=o(1);e(".logged",logStatus);var n=$("#houseId").val();$("i.unlogged").on("tap",function(){location.href="/login"}),$(".goBack").on("tap",function(){location.href="/list"}),$(".info-tabs__tab").tap(function(){$(window).scrollTo({toT:$($(this).find("a").data("href")).offset().top,durTime:120})}),$(".collect-icon").on("tap",function(t){if(t.stopPropagation(),logStatus){var e=$(this),o=$(".collect-count");e.hasClass("do-collect")?(e.removeClass("do-collect").addClass("donot-collect"),o.text(parseInt(o.text())-1),$.ajax({url:"/common/collect",type:"GET",data:{type:"0",id:n}})):e.hasClass("donot-collect")&&(e.removeClass("donot-collect").addClass("do-collect"),o.text(parseInt(o.text())+1),$.ajax({url:"/common/collect",type:"GET",data:{type:"1",id:n}}))}else location.href="/login"}),$(".like-icon").on("tap",function(t){if(t.stopPropagation(),logStatus){var e=$(this),o=$(".like-count");e.hasClass("do-like")?(e.removeClass("do-like").addClass("donot-like"),o.text(parseInt(o.text())-1),$.ajax({url:"/common/like",type:"GET",data:{type:"0",id:n}})):e.hasClass("donot-like")&&(e.removeClass("donot-like").addClass("do-like"),o.text(parseInt(o.text())+1),$.ajax({url:"/common/like",type:"GET",data:{type:"1",id:n}}))}else location.href="/login"}),_.templateSettings={evaluate:/{{([\s\S]+?)}}/g,interpolate:/{{=([\s\S]+?)}}/g,escape:/{{-([\s\S]+?)}}/g};var a=_.template($("#commentsTemplate").html());$.ajax({url:"/comment/getComments",type:"GET",data:{houseId:n},success:function(e){t(e)}});var s=$("#comment-input"),i=$(".reply-btn");i.tap(function(){if(!logStatus)return void(location.href="/login");if(s.val().length<3)return void alert("起码要说三个字吧？");var e=s.data("id")||"",o=s.val(),a={content:o,houseId:n};e&&(a.toId=e),$.ajax({url:"/comment/writeComment",type:"GET",data:a,success:function(e){t(e.data),s.val("").attr({placeholder:"你的看法..."}).removeAttr("data-id"),i.removeClass("reply-btn-shine");var o=$("#"+e.lastMsgId);$(window).scrollTo({toT:o.offset().top,durTime:300}),o.css({background:"#c2e1e1"}).animate({background:"#ffffff"},1400,"ease-out")}})}),$(".comments").on("tap",".comments__delete",function(e){$(this).parents(".comments__item").addClass("tap-from-delete"),$.ajax({url:"/comment/delComment",type:"GET",data:{id:$(this).data("id"),houseId:n,toId:$(this).data("toId")},success:function(e){t(e)}})}),$(".comments").on("click",".comments__item",function(){var t=this;return $(t).find(".comments__delete").length?void(s.val()||s.attr({placeholder:"你的看法..."}).removeAttr("data-id")):(s[0].focus(),void setTimeout(function(){if(!$(t).hasClass("tap-from-delete")){if(!logStatus)return void(location.href="/login");$(window).scrollTo({toT:$("#comments").offset().top,durTime:120}),setTimeout(function(){s.attr({placeholder:"回复 | "+$(t).data("from")+"说 : "+$(t).find(".comments__content").text().substring(0,20)+"...","data-id":$(t).data("id")})},100)}},0))}),s.blur(function(){$(this).val()||s.attr({placeholder:"你的看法..."}).removeAttr("data-id")}),s.on("input",function(){s.val().length>2?i.hasClass("reply-btn-shine")||i.addClass("reply-btn-shine"):i.removeClass("reply-btn-shine")}),logStatus&&$.ajax({url:"/login/getMessageCnt",type:"get",success:function(t){var e=$(".unReadMsgCnt");t.count>0?e.text(t.count).show():e.hide()}})})},function(t,e){var o=function(t,e){e&&$(document).ready(function(){var e=$(".mask--myinfo"),o=$(".myinfo");$(t).tap(function(){$(".unReadMsgCnt").hide(),"none"===e.css("display")?(e.show(),$.ajax({url:"/login/getCollectCnt",type:"get",success:function(t){$($(".myinfo").contents()[0]).find("#mycollect-count").text(t.count)}}),$.ajax({url:"/login/getMessageCnt",type:"get",success:function(t){var e=$($(".myinfo").contents()[0]);e.find("#mymessage-count").text(t.count),t.count>0?e.find(".my-message").addClass("message-tip"):e.find(".my-message").removeClass("message-tip")}}),o.animate({width:"80%"},200,"ease-out")):(e.hide(),$($(".myinfo").contents()[0]).find("#mycollect-count").text(""),o.animate({width:"0"},200,"ease-out"))}),e.on("touchmove",function(t){t.preventDefault()}),e.tap(function(){e.hide(),o.animate({width:"0"},200,"ease-out")}),$(o.prop("contentWindow").document).on("touchmove",function(t){t.preventDefault()})})};t.exports=o}]);