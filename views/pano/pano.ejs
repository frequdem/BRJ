<% include ../head.ejs %>
    <title>别人家</title>
    <link rel='stylesheet' href='/stylesheets/pano/pano.css' />
    <script type="text/javascript" src="/javascripts/js/pano/pano.js"></script>
    <script type="text/javascript" src="/javascripts/lib/pano/built/Pano.js"></script>
    <!-- <script type="text/javascript" src="/javascripts/lib/Compass.js"></script> -->

    <!--顶点着色器-->
    <script type="x-shader/x-vertex" id="vshader">
         uniform mat4 projection;
         uniform mat4 modelview;
         attribute vec3 coords;
         varying vec3 vCoords;
         void main() {
            vec4 eyeCoords = modelview * vec4(coords,1.0);
            gl_Position = projection * eyeCoords;
            vCoords = coords;//gl_Position.xyz;
         }
     </script>
    <!--片元着色器-->
    <script type="x-shader/x-fragment" id="fshader">
         precision mediump float;
         varying vec3 vCoords;
         uniform float uSwitchRatio;
         uniform samplerCube uCubeSamplerCur;

         void main() {
                vec4 texColor = textureCube(uCubeSamplerCur, vCoords);
                if(uSwitchRatio == 0.0){
                gl_FragColor = texColor;
                }else{
                gl_FragColor = (vec4(0.12,0.12,0.12,1.0) - texColor)*pow(uSwitchRatio,6.0) + texColor  ;
                }
                //gl_FragColor = vec4(0.5, 0.0, 0.0, 1.0);
         }
     </script>
    <!--相邻全景位置顶点着色器-->
    <script type="x-shader/x-vertex" id="vNeighshader">
         attribute vec4 aCoords;
         uniform mat4 uProjection;
         uniform mat4 uViewMat;
         uniform int uIdSel;
         attribute float aIdCur;
         uniform float uAlpha;
         varying float vAlpha;
         void main() {
            vAlpha = uAlpha;
            gl_Position = uProjection * uViewMat* aCoords;
            //gl_PointSize = 20.0;
         }
     </script>
    <!--相邻全景位置片元着色器-->
    <script type="x-shader/x-fragment" id="fNeighshader">
         precision mediump float;
         varying float vAlpha;
         void main() {
              gl_FragColor = vec4(0.46,0.7,0.7,vAlpha);
         }
     </script>
</head>
<body>
    <div id="all-goods-base" style="position: absolute; top: 0; left: 0"></div>
<div>
    <i class="iconfont goBack">&#xe61d;</i>
</div>
<canvas id="canvas">您的浏览器不支持canvas元素，赶紧更新吧</canvas>
<div id="compass"></div>

<script>
/*       pts : {"a":[{position:[-36.711931,-24.502305,89.732219],path:"resource/5842fa95a5ebde0133fe9bcd/b/",planPt:[40,70]}],
                "b":[{position:[70.566856,-36.871385,-60.504709],path:"resource/5842fa95a5ebde0133fe9bcd/a/",planPt:[63,85]},{position:[26.053868,-65.562604,70.871299],path:"resource/5842fa95a5ebde0133fe9bcd/c/",planPt:[63,50]}],
                "c":[{position:[34.341212,-52.466784,77.89684],path:"resource/5842fa95a5ebde0133fe9bcd/b/",planPt:[40,70]}]
            }*/
    var pts = JSON.parse(JSON.stringify(<%-panos%>));
    var settings = {
        GI:{
            canvas : document.getElementById('canvas'),
            firstPath : "resource/5842fa95a5ebde0133fe9bcd/a/",
            smoothSwitch : true,
            pts: {
                a: {
                    neighs: {
                        b: [-36.711931,-24.502305,89.732219]
                    },
                    goods: [{
                        pos: [-30.711931,-30.502305,89.732219],
                        info: {
                            name: '电视',
                            type: '电器',
                            brand: 'TCL'
                        }
                    },{
                        pos: [-15.711931,10.502305,89.732219],
                        info: {
                            name: '书架',
                            type: '书架',
                            brand: '宜家'
                        }
                    }]
                },
                b: {
                    neighs: {
                        a: [70.566856,-36.871385,-60.504709],
                        c: [34.341212,-52.466784,77.89684]
                    },
                    goods: [{
                        pos: [-30.711931,-30.502305,89.732219],
                        info: {
                            name: '电视',
                            type: '电器',
                            brand: 'TCL'
                        }
                    }]
                }
            }
        }
    };
    var qj = new PanoAJK.Init(settings);

    var argsForCompass = {
        GI : qj.Core,
        dom : document.getElementById('compass'),
        controller : qj.Controller,
        angle : 98,
        path: 'images/pano/'
    };
    var compass = new PanoAJK.Component.Compass(argsForCompass);
    qj.addComponent(compass);
    qj.draw();

    function goodPtShine() {
        var goodsJq = $('#all-goods-base');
        goodsJq.on('tap', '.good-point', function(e) {
            e.preventDefault();
            e.stopPropagation();
            alert(qj.Core.sys.pts[qj.Core.sys.ptName].goods[parseInt($(this).attr('id'))].info.name);
            
        })
        var goodPtsJq = $('.good-point-out');        
        function goodPtShine1() {
            goodPtsJq.animate({'background': '#888', 'width': '0.26rem', 'height': '0.26rem', 'border-radius': '0.13rem', 'opacity': '0.2'}, 1300,  function() {
                    goodPtsJq.css({ 'background': '#222', 'width': '0.1rem', 'height': '0.1rem', 'border-radius': '0.05rem', 'opacity': '0.8'});
                    requestAnimationFrame(goodPtShine1);
            });
        }    
        if (goodPtsJq.length) {
            goodPtShine1();
        }
    }  
    goodPtShine();
</script>
</body>
</html>